<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="873px" preserveAspectRatio="none" style="width:1847px;height:873px;" version="1.1" viewBox="0 0 1847 873" width="1847px" zoomAndPan="magnify"><defs><filter height="300%" id="fy4ux1x6gobtm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster beam_client--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="170" style="stroke: #000000; stroke-width: 1.5;" width="229" x="669" y="57"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="740" y="72.5352">Beam Client</text><!--cluster Beam Client SDK    --><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="87" style="stroke: #000000; stroke-width: 1.5;" width="157" x="709" y="108"/><polygon fill="#FFFFFF" points="849,113,849,127,861,127,861,119,855,113,849,113" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="855" x2="855" y1="113" y2="119"/><line style="stroke: #000000; stroke-width: 1.5;" x1="861" x2="855" y1="119" y2="119"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="717" y="123.5352">Beam Client SDK</text><!--cluster flink_client--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="638" style="stroke: #000000; stroke-width: 1.5;" width="615" x="22" y="113.5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="270.5" y="129.0352">Flink Client JVM</text><!--cluster runner_jar--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="170" style="stroke: #000000; stroke-width: 1.5;" width="551" x="54" y="267"/><polygon fill="#FFFFFF" points="588,272,588,286,600,286,600,278,594,272,588,272" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="594" x2="594" y1="272" y2="278"/><line style="stroke: #000000; stroke-width: 1.5;" x1="600" x2="594" y1="278" y2="278"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="271" y="282.5352">Flink Runner Jar</text><!--cluster job_server--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="87" style="stroke: #000000; stroke-width: 1.5;" width="479" x="94" y="318"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="290" y="333.5352">gRPC Server</text><!--cluster Flink Worker Node--><polygon fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" points="661,479,671,469,1825,469,1825,851,1815,861,661,861,661,479" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1815" x2="1824" y1="479" y2="470"/><line style="stroke: #000000; stroke-width: 1.5;" x1="661" x2="1815" y1="479" y2="479"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1815" x2="1815" y1="479" y2="861"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="1172" y="495.5352">Flink Worker Node</text><!--cluster flink_task--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="320" style="stroke: #000000; stroke-width: 1.5;" width="758" x="1043" y="517"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="171" x="1336.5" y="532.5352">Flink TaskManager JVM</text><!--cluster Flink Runner Jar--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="253" style="stroke: #000000; stroke-width: 1.5;" width="710" x="1067" y="560"/><polygon fill="#FFFFFF" points="1760,565,1760,579,1772,579,1772,571,1766,565,1760,565" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1766" x2="1766" y1="565" y2="571"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1772" x2="1766" y1="571" y2="571"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="1363.5" y="575.5352">Flink Runner Jar</text><!--cluster harness_manager--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="170" style="stroke: #000000; stroke-width: 1.5;" width="465" x="1280" y="611"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="1450.5" y="626.5352">Harness Manager</text><!--cluster gRPC Server--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="87" style="stroke: #000000; stroke-width: 1.5;" width="393" x="1320" y="662"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="1473" y="677.5352">gRPC Server</text><!--cluster docker--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="170" style="stroke: #000000; stroke-width: 1.5;" width="318" x="693" y="611"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="50" x="827" y="626.5352">Docker</text><!--cluster SDK Harness (Environment)--><rect fill="#FFFFFF" filter="url(#fy4ux1x6gobtm)" height="87" style="stroke: #000000; stroke-width: 1.5;" width="246" x="733" y="662"/><polygon fill="#FFFFFF" points="962,667,962,681,974,681,974,673,968,667,962,667" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="968" x2="968" y1="667" y2="673"/><line style="stroke: #000000; stroke-width: 1.5;" x1="974" x2="968" y1="673" y2="673"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="757" y="677.5352">SDK Harness (Environment)</text><!--entity beam_client_code--><rect fill="#FEFECE" filter="url(#fy4ux1x6gobtm)" height="36.4883" style="stroke: #000000; stroke-width: 1.5;" width="100" x="725" y="143"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="735" y="166.5352">Client Code</text><path d="M38,148.5 L38,173.8105 L434,173.8105 L434,158.5 L424,148.5 L38,148.5 " fill="#FBFB77" filter="url(#fy4ux1x6gobtm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M424,148.5 L424,158.5 L434,158.5 L424,148.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="375" x="44" y="166.0684">A new Flink ExecutionEnvironment is spawned for each job.</text><path d="M38.5,694.5 L38.5,735.1211 L371.5,735.1211 L371.5,704.5 L361.5,694.5 L38.5,694.5 " fill="#FBFB77" filter="url(#fy4ux1x6gobtm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M361.5,694.5 L361.5,704.5 L371.5,704.5 L361.5,694.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="44.5" y="712.0684">The runner jar is submitted to Flink out-of-band.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="44.5" y="727.3789">This starts the Job API.</text><!--entity job_service--><rect fill="#FEFECE" filter="url(#fy4ux1x6gobtm)" height="36.4883" style="stroke: #000000; stroke-width: 1.5;" width="152" x="405" y="353"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="415" y="376.5352">Job API (JobService)</text><!--entity artifact_staging--><rect fill="#FEFECE" filter="url(#fy4ux1x6gobtm)" height="36.4883" style="stroke: #000000; stroke-width: 1.5;" width="260" x="110" y="353"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="240" x="120" y="376.5352">Artifact API (ArtifactStagingService)</text><!--entity operator--><rect fill="#FEFECE" filter="url(#fy4ux1x6gobtm)" height="36.4883" style="stroke: #000000; stroke-width: 1.5;" width="169" x="1083.5" y="697"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="149" x="1093.5" y="720.5352">Fused Stage Operator</text><!--entity control_plane--><rect fill="#FEFECE" filter="url(#fy4ux1x6gobtm)" height="36.4883" style="stroke: #000000; stroke-width: 1.5;" width="185" x="1511.5" y="697"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="1521.5" y="720.5352">Control and Data Planes</text><!--entity other_grpc--><rect fill="#FEFECE" filter="url(#fy4ux1x6gobtm)" height="36.4883" style="stroke: #000000; stroke-width: 1.5;" width="140" x="1336" y="697"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1346" y="720.5352">Auxiliary Services</text><!--entity fn_execution--><rect fill="#FEFECE" filter="url(#fy4ux1x6gobtm)" height="36.4883" style="stroke: #000000; stroke-width: 1.5;" width="214" x="749" y="697"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="194" x="759" y="720.5352">Boot Code and Fn Execution</text><path d="M489.5,8 L489.5,33.3105 L864.5,33.3105 L864.5,18 L854.5,8 L489.5,8 " fill="#FBFB77" filter="url(#fy4ux1x6gobtm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M854.5,8 L854.5,18 L864.5,18 L854.5,8 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="495.5" y="25.5684">The client might be code in any Beam SDK (not just Java)</text><!--link GMN8 to beam_client--><path d="M677,33.308 C677,37.4292 677,42.4545 677,48.0988 C677,50.921 677,53.8979 677,56.994 " fill="none" id="GMN8-beam_client" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link GMN18 to runner_jar--><path d="M204.56,173.607 C172.058,187.215 122.2,212.871 94,251 C91.9964,253.7091 90.1182,256.5352 88.3575,259.4538 C87.4772,260.9131 86.6263,262.3955 85.8038,263.8979 C85.3925,264.6491 84.9883,265.4053 84.5912,266.1662 C84.4919,266.3564 84.393,266.5469 84.2946,266.7377 " fill="none" id="GMN18-runner_jar" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link runner_jar to GMN21--><path d="M87.5605,437.1311 C87.6743,437.414 87.7881,437.6968 87.9018,437.9795 C88.1294,438.5449 88.3569,439.1099 88.5844,439.6743 C90.4045,444.189 92.2215,448.6633 94,453 C131.179,543.66 177.63,651.085 196.471,694.428 " fill="none" id="runner_jar-GMN21" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link beam_client_code to job_service--><path d="M766.722,179.318 C757.544,197.084 741.316,224.645 721,243 C665.259,293.363 585.914,330.237 533.952,350.9 " fill="none" id="beam_client_code-job_service" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="529.011,352.849,538.8509,353.2684,533.6624,351.0147,535.9161,345.8262,529.011,352.849" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="636.462" y="283.9654">Run</text><!--link beam_client_code to artifact_staging--><path d="M769.061,179.278 C761.355,198.7 745.872,229.303 721,243 C688.483,260.907 421.843,238.193 387,251 C332.364,271.082 282.903,320.418 257.652,348.861 " fill="none" id="beam_client_code-artifact_staging" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="254.104,352.9,263.0486,348.7776,257.4036,349.1433,257.0379,343.4983,254.104,352.9" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="440.136" y="244.4214">Put Artifact</text><!--link harness_manager to docker--><path d="M1314.1511,609.8611 C1314.2005,609.4532 1314.2494,609.0447 1314.2976,608.6357 C1314.394,607.8178 1314.488,606.9979 1314.5793,606.1762 C1314.9448,602.8891 1315.2691,599.5721 1315.5465,596.232 C1316.1013,589.5519 1316.4684,582.7793 1316.6025,575.9686 C1316.8706,562.3472 1316.2063,548.5735 1314.245,535.0821 C1310.3225,508.0993 1301.2125,482.246 1284,461 C1278.98,454.801 1274.43,457.895 1266.5,457 C1238.01,453.786 778.986,453.786 750.5,457 C742.572,457.895 738.354,455.085 733,461 C696.0135,501.8585 687.3498,562.7285 688.2489,614.6378 C688.4737,627.6151 689.2961,640.0323 690.4231,651.4369 C690.9866,657.1391 691.6263,662.5882 692.3054,667.7275 C692.4752,669.0123 692.6475,670.2778 692.8216,671.523 C692.8652,671.8343 692.9088,672.1444 692.9526,672.4531 " fill="none" id="harness_manager-docker" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="692.9526,672.4531,695.6499,662.9808,692.2509,667.5026,687.7291,664.1036,692.9526,672.4531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="576.875" y="711.0774">Create Environment</text><!--link job_service to operator--><path d="M557.241,378.748 C678.72,390.629 909.588,418.154 979,461 C1073.01,519.028 1136.12,642.451 1158.73,692.372 " fill="none" id="job_service-operator" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1160.79,696.969,1160.7534,687.1202,1158.7423,692.4075,1153.455,690.3965,1160.79,696.969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="850.912" y="428.3154">Execute</text><!--link operator to harness_manager--><path d="M1252.84,715 C1258.61,715 1264.38,715 1270.1488,715 C1273.0331,715 1275.9172,715 1278.8008,715 C1279.1612,715 1279.5217,715 1279.8821,715 " fill="none" id="operator-harness_manager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1279.8821,715,1270.8821,711,1274.8821,715,1270.8821,719,1279.8821,715" style="stroke: #A80036; stroke-width: 1.0;"/><!--link fn_execution to control_plane--><path d="M864.323,691.943 C887.862,631.275 961.322,470.898 1084.5,457 C1127.78,452.117 1433.22,452.117 1476.5,457 C1484.43,457.895 1487.86,455.901 1494,461 C1567.46,522.048 1593.16,641.411 1600.98,691.738 " fill="none" id="fn_execution-control_plane" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1601.76,696.958,1604.3753,687.4627,1601.0155,692.0137,1596.4645,688.6539,1601.76,696.958" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="862.456,696.817,869.411,689.8437,864.2448,692.1479,861.9405,686.9816,862.456,696.817" style="stroke: #A80036; stroke-width: 1.0;"/><!--link fn_execution to other_grpc--><path d="M865.489,696.794 C891.073,649.628 966.393,522.844 1067,461 C1073.8,456.822 1076.57,457.895 1084.5,457 C1109.89,454.135 1289.11,454.135 1314.5,457 C1412.37,468.043 1411.75,630.293 1407.96,691.692 " fill="none" id="fn_execution-other_grpc" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1407.61,696.969,1412.1957,688.2528,1407.9402,691.9799,1404.2131,687.7245,1407.61,696.969" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml

!pragma horizontalLineBetweenDifferentPackageAllowed

note top of beam_client: The client might be code in any Beam SDK (not just Java)
rectangle "Beam Client" as beam_client {
    artifact "Beam Client SDK    " {
        rectangle "Client Code" as beam_client_code
    }
}

rectangle "Flink Client JVM" as flink_client {
    artifact "Flink Runner Jar" as runner_jar {
        rectangle "gRPC Server" as job_server {
            rectangle "Job API (JobService)" as job_service
            rectangle "Artifact API (ArtifactStagingService)" as artifact_staging
        }
    }
    note top of runner_jar: A new Flink ExecutionEnvironment is spawned for each job.
    note bottom of runner_jar: The runner jar is submitted to Flink out-of-band.\nThis starts the Job API.
}

node "Flink Worker Node" {
    rectangle "Flink TaskManager JVM" as flink_task {
        artifact "Flink Runner Jar" {
            rectangle "Harness Manager" as harness_manager {
                rectangle "gRPC Server" {
                    rectangle "Control and Data Planes" as control_plane
                    rectangle "Auxiliary Services" as other_grpc
                }
            }
            rectangle "Fused Stage Operator" as operator
        }
    }
    rectangle "Docker" as docker {
        artifact "SDK Harness (Environment)" {
            rectangle "Boot Code and Fn Execution" as fn_execution
        }
    }
}

beam_client_code -down-> job_service: Run
beam_client_code - -> artifact_staging: Put Artifact

harness_manager - -> docker: Create Environment

job_service -down-> operator: Execute

operator -> harness_manager

fn_execution <-> control_plane
fn_execution - -> other_grpc

@enduml

PlantUML version 1.2018.01(Sun Jan 28 10:08:22 PST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Mac OS X
OS Version: 10.13.3
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>